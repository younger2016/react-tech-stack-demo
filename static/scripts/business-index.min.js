/*!
 * 云服务平台
 * update: 2016-08-23 09:26:03
 */
!function(e){function t(r){if(a[r])return a[r].exports;var o=a[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var a={};return t.m=e,t.c=a,t.p="",t(0)}({0:function(e,t,a){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};String.prototype.equalsIgnoreCase=function(e){return null!=e&&this.toLowerCase()===e.toLowerCase()},e.exports=window.cb={},cb.namespace=function(){for(var e,t,a,r=0,o=arguments.length;r<o;r++)if(t=arguments[r]){e=cb,a=t.split(".");for(var n="cb"===a[0]?1:0,i=a.length;n<i;n++)e[a[n]]=e[a[n]]||{},e=e[a[n]]}return e},cb.utils={},cb.utils.queryString=function(e){this.pathname="",this.query={},this.init=function(){e||(e=location.search);var t=e.indexOf("?"),a=e.indexOf("#");if(t>=0){if(this.pathname=e.substr(0,t),e=a<0?e.substr(t+1):e.substring(t+1,a),e.length>0){e=e.replace(/\+/g," ");for(var r=e.split("&"),o=0,n=r.length;o<n;o++){var i=r[o].split("="),s=decodeURIComponent(i[0]),l=2==i.length?decodeURIComponent(i[1]):s;this.query[s]=l}}}else this.pathname=e},this.set=function(e,t){this.query[e]=t},this.get=function(e){return this.query[e]},this.has=function(e){return null!=this.query[e]},this.toStr=function(){var e=["?"];for(var t in this.query)e.push(encodeURIComponent(t)),e.push("="),e.push(encodeURIComponent(this.query[t])),e.push("&");return 1===e.length?"":(e.splice(e.length-1,1),e.join(""))},this.init()},cb.utils.browser=function(){return window.ActiveXObject||"ActiveXObject"in window?"IE":null},cb.utils.isArray=function(e){return"function"==typeof Array.isArray?Array.isArray(e):"[object Array]"===Object.prototype.toString.call(e)},cb.utils.isPlainObject=function(e){if(!e||"[object Object]"!==Object.prototype.toString.call(e))return!1;var t=Object.prototype.hasOwnProperty.call(e,"constructor"),a=e.constructor&&e.constructor.prototype&&Object.prototype.hasOwnProperty.call(e.constructor.prototype,"isPrototypeOf");if(e.constructor&&!t&&!a)return!1;var r;for(r in e);return"undefined"==typeof r||Object.prototype.hasOwnProperty.call(e,r)},cb.utils.extend=function(){var e,t,a,o,n,i,s=arguments[0],l=1,c=arguments.length,u=!1;for("boolean"==typeof s?(u=s,s=arguments[1]||{},l=2):("object"!==("undefined"==typeof s?"undefined":r(s))&&"function"!=typeof s||null==s)&&(s={});l<c;++l)if(e=arguments[l],null!=e)for(t in e)a=s[t],o=e[t],s!==o&&(u&&o&&(this.isPlainObject(o)||(n=this.isArray(o)))?(n?(n=!1,i=a&&this.isArray(a)?a:[]):i=a&&this.isPlainObject(a)?a:{},s[t]=this.extend(u,i,o)):"undefined"!=typeof o&&(s[t]=o));return s},cb.utils.getNewId=function(e){var t=(cb.cache.newIds.get(e)||0)+1;return cb.cache.newIds.set(e,t),e+"_"+t},cb.utils.getCookie=function(e){var t,a=new RegExp("(^|)"+e+"=([^;]*)(;|$)");return(t=document.cookie.match(a))?unescape(t[2]):null},cb.events={},cb.events.on=function(e,t,a){if(e&&t){this._events||(this._events={});var r=this._events[e]||(this._events[e]=[]);r.push({callback:t,context:a})}},cb.events.un=function(e,t){if(e&&this._events&&this._events[e])if(t){var a=this._events[e].findIndex(function(e){if(e.callback===t)return!0});a!==-1&&this._events[e].removeData(this._events[e][a])}else delete this._events[e]},cb.events.hasEvent=function(e){if(e)return this._events&&this._events[e]&&this._events[e].length},cb.events.execute=function(e){if(e){var t=this._events?this._events[e]:null;if(!t)return!0;var a=!0,r=Array.prototype.slice.call(arguments,1);return t.forEach(function(e){a=e.callback.apply(e.context||this,r)!==!1&&a},this),a}},cb.models={},cb.models.register=function(e,t){cb.models[e]=t(e)},cb.models.register("BaseModel",function(e){var t=function(e){var t=[];if(e)for(var a in e)t.push(a);var r=cb.utils.extend({},{listeners:[],propertyNames:t},e);this._get_data=function(e){if(e)return r[e]},this._set_data=function(e,t){e&&(r[e]=t)},this._del_data=function(e){e&&delete r[e]}};return t.prototype.modelType=e,t.prototype.setParent=function(e){this._set_data("parent",e)},t.prototype.getParent=function(){return this._get_data("parent")},t.prototype.setName=function(e){this._set_data("name",e)},t.prototype.getName=function(){return this._get_data("name")},t.prototype.addListener=function(e){var t=this._get_data("listeners");t.indexOf(e)>=0||(t.push(e),this.setData())},t.prototype.removeListener=function(e){var t,a=this._get_data("listeners");(t=a.indexOf(e))<0||a.splice(t,1)},t.prototype.setData=function(e,t){if(!arguments.length){var a=this._get_data("propertyNames");if(!a.length)return;return void a.forEach(function(e){this.setData(e,this.getData(e))},this)}if(2===arguments.length){var a=this._get_data("propertyNames");a.indexOf(e)<0&&a.push(e),this._set_data(e,t);var o={};return o[e]=t,void this.doPropertyChange("setState",o)}if("object"===("undefined"==typeof e?"undefined":r(e)))for(var n in e)this.setData(n,e[n]);else this.setData("value",e)},t.prototype.getData=function(e){return this._get_data(e)},t.prototype.clear=function(){this.setData("value",this.getData("defaultValue"))},t.prototype.setDirty=function(e){return e?void this._set_data("isDirty",!0):(this._del_data("isDirty"),void this._set_data("originalData",this.getData("value")))},t.prototype.getDirtyData=function(){var e=this.getData("value");if(this._get_data("isDirty"))return e;if(e!==this._get_data("originalData"))return e},t.prototype.setState=function(e,t,a){a||this._set_data(e,t);var r={};r[e]=t,this.doPropertyChange("setState",r,a)},t.prototype.getState=function(e,t){if(!t)return this._get_data(e);var a=this._get_data("listeners"),r=a.find(function(e){return e.ctrlName===t});return r?r.getState(e):this._get_data(e)},t.prototype.fireEvent=function(e,t){this.execute("before"+e,t)&&(this.execute(e,t),this.execute("after"+e,t))},t.prototype.setProxy=function(e){e instanceof cb.rest.DynamicProxy?this._set_data("proxy",e):this._set_data("proxy",cb.rest.DynamicProxy.create(e))},t.prototype.getProxy=function(){return this._get_data("proxy")},t.prototype.doPropertyChange=function(e,t,a){var r=this._get_data("listeners");if(r.length)if(a){var o=r.find(function(e){return e.ctrlName===a});if(!o||"function"!=typeof o[e])return;o[e](t)}else r.forEach(function(a){"function"==typeof a[e]&&a[e](t)})},t}),cb.utils.extend(cb.models.BaseModel.prototype,cb.events),cb.models.register("SimpleModel",function(e){var t=function(e){cb.models.BaseModel.call(this,e)};return t.prototype=new cb.models.BaseModel,t.prototype.modelType=e,t.prototype.setValue=function(e,t){var a=this.getValue();if(e!==a){var r={value:e,oldValue:a};t&&!this.execute("beforeValueChange",r)||(this.setData("value",e),t&&this.execute("afterValueChange",r))}},t.prototype.getValue=function(){return this.getData("value")},t.prototype.setReadOnly=function(e,t){this.setState("readOnly",e,t)},t.prototype.getReadOnly=function(e){return this.getState("readOnly",e)},t}),cb.models.register("ListModel",function(e){var t=function(e){var t={multiple:!1,valueField:"value",textField:"text",dataSource:[],dataSourceMode:"local",keyMap:{}};if(e=cb.utils.extend({},t,e),cb.models.BaseModel.call(this,e),e.cEnumString){var a=JSON.parse(e.cEnumString);for(var r in a){var o={};o[e.valueField]=r,o[e.textField]=a[r],e.dataSource.push(o),e.keyMap[r]=o}delete e.cEnumString}};t.prototype=new cb.models.BaseModel,t.prototype.modelType=e,t.prototype.clear=function(){var e=this.getData("defaultValue");this._set_data("value",e),this.doPropertyChange("setValue",r.call(this,e))},t.prototype.setData=function(e){if(!arguments.length){var e={value:this._get_data("value"),readOnly:this._get_data("readOnly"),multiple:this._get_data("multiple"),valueField:this._get_data("valueField"),textField:this._get_data("textField"),dataSource:this._get_data("dataSource")};return void this.doPropertyChange("setData",cb.utils.extend(!0,{},e))}this._set_data("value",e),this.doPropertyChange("setValue",r.call(this,e))},t.prototype.setDataSource=function(e,t,r){if("local"===this._get_data("dataSourceMode")){var o=e;if(!this.execute("beforeSetDataSource",o))return;a.call(this,o),this.execute("afterSetDataSource",o)}else{var n=cb.rest.DynamicProxy.create({queryData:e}),i=cb.utils.extend(!0,{},t);n.queryData(i,function(e,t){if(e)return void alert(e.message);if(r)r(t);else{var o=cb.utils.isArray(t)?t:[];if(!this.execute("beforeSetDataSource",o))return;a.call(this,o),this.execute("afterSetDataSource",o)}},this)}};var a=function(e){this._set_data("dataSource",e),this.doPropertyChange("setState",{dataSource:e});var t={};if(cb.utils.isArray(e)){var a=this._get_data("keyField");e.forEach(function(e){null!=e[a]&&(t[e[a]]=e)},this)}this._set_data("keyMap",t)},r=function(e){var t=this._get_data("keyMap");if(cb.utils.isArray(e)){var a=[];return e.forEach(function(e){a.push(t[e])}),a}return t[e]};return t.prototype.select=function(e){var t=r.call(this,e);this.execute("beforeSelect",t)&&(this.setValue(e,!0),this.execute("select",t),this.execute("afterSelect",t))},t.prototype.getSelectedNodes=function(){return r.call(this,this.getSelectedKeys())},t.prototype.getSelectedKeys=function(){return this._get_data("value")},t.prototype.setValue=function(e,t){var a=this.getValue();if(e!==a){var o=r.call(this,e),n=r.call(this,a),i={value:o,oldValue:n};t&&!this.execute("beforeValueChange",i)||(this._set_data("value",e),this.doPropertyChange("setValue",o),t&&this.execute("afterValueChange",i))}},t.prototype.getValue=function(){return this.getData("value")},t.prototype.setReadOnly=function(e,t){this.setState("readOnly",e,t)},t}),cb.models.register("ReferModel",function(e){var t=function(e){var t={multiple:!1};e=cb.utils.extend({},t,e),cb.models.BaseModel.call(this,e)};return t.prototype=new cb.models.BaseModel,t.prototype.modelType=e,t.prototype.setFilter=function(e){this._set_data("filter",e)},t.prototype.getFilter=function(){return this._get_data("filter")},t.prototype.setReturnFields=function(e){this._set_data("returnFields",e)},t.prototype.browse=function(){if(this.execute("beforeBrowse")){var e=this._get_data("vm");if(e)return void e.initData();var t=this;a(92);var r={multiple:t._get_data("multiple"),refId:t._get_data("cRefId")},e=new cb.viewmodels.ReferViewModel({parent:t,params:r});e.on("afterOkClick",function(e){t.setValue(e,!0)}),e.on("afterInit",function(a){t.doPropertyChange("open",{vm:e,referType:a}),t.execute("afterBrowse")}),t._set_data("vm",e)}},t.prototype.setValue=function(e,t){if(cb.utils.isArray(e)&&e.length){this._get_data("multiple")||(e=e[0]);var a=this.getSelectedNodes(),r={value:e,oldValue:a};if(t&&!this.execute("beforeValueChange",r))return;this._set_data("value",e.id),this._set_data("select",e),this.doPropertyChange("setValue",e.name),t&&this.execute("afterValueChange",r)}},t.prototype.getValue=function(){return this._get_data("value")},t.prototype.getSelectedNodes=function(){return this._get_data("select")},t.prototype.setReadOnly=function(e,t){this.setState("readOnly",e,t)},t}),cb.models.register("FilterModel",function(e){var t=function(e){var t={between:!1};e=cb.utils.extend({},t,e),a(e),cb.models.BaseModel.call(this,e)};t.prototype=new cb.models.BaseModel,t.prototype.modelType=e;var a=function(e){e.between="between"===e.compareLogic;var t=cb.utils.extend(!0,{},e),a=e.ctrlType&&e.ctrlType.trim().toLocaleLowerCase();switch(a){case"refer":e.fromModel=new cb.models.ReferModel(cb.utils.extend(!0,{value:e.value1},t)),e.between&&(e.toModel=new cb.models.ReferModel(cb.utils.extend(!0,{value:e.value2},t)));case"select":e.fromModel=new cb.models.ListModel(cb.utils.extend(!0,{value:e.value1},t)),e.between&&(e.toModel=new cb.models.ListModel(cb.utils.extend(!0,{value:e.value2},t)));default:e.fromModel=new cb.models.SimpleModel(cb.utils.extend(!0,{value:e.value1},t)),e.between&&(e.toModel=new cb.models.SimpleModel(cb.utils.extend(!0,{value:e.value2},t)))}};return t.prototype.getFromModel=function(){return this._get_data("fromModel")},t.prototype.getToModel=function(){return this._get_data("toModel")},t.prototype.getData=function(){var e={value1:this.getFromModel().getData("value")};return this._get_data("between")&&(e.value2=this.getToModel().getData("value")),e},t}),cb.models.register("TreeModel",function(e){var t=function(e){var t={multiple:!1,checkable:!1,expandAll:!1,keyField:"key",titleField:"title",dataSource:[],dataSourceMode:"local",keyMap:{}};e=cb.utils.extend({},t,e),cb.models.BaseModel.call(this,e)};t.prototype=new cb.models.BaseModel,t.prototype.modelType=e,t.prototype.setData=function(){var e=this._get_data("propertyNames"),t={};e.forEach(function(e){"dataSourceMode"!==e&&"keyMap"!==e&&(t[e]=this._get_data(e))},this),this.doPropertyChange("setState",t)},t.prototype.setDataSource=function(e,t,r){if("local"===this._get_data("dataSourceMode")){var o=e;if(!this.execute("beforeSetDataSource",o))return;a.call(this,o),this.execute("afterSetDataSource",o)}else{var n=cb.rest.DynamicProxy.create({queryData:e}),i=cb.utils.extend(!0,{},t);n.queryData(i,function(e,t){if(e)return void alert(e.message);if(r)r(t);else{var o=cb.utils.isArray(t)?t:[];if(!this.execute("beforeSetDataSource",o))return;a.call(this,o),this.execute("afterSetDataSource",o)}},this)}},t.prototype.addNode=function(e,t){var a=this._get_data("dataSource"),o=this._get_data("keyMap");if(t){var n=o[t];if(!n)return;n.children||(n.children=[]),n.children.push(e)}else{var i=this._get_data("keyField");if(null==e[i])return;a.push(e)}this.doPropertyChange("setState",{dataSource:a}),r.call(this,e,o)},t.prototype.updateNode=function(e){var t=this._get_data("keyField");if(null!=e[t]){var a=this._get_data("keyMap"),r=a[e[t]];if(r){for(var o in e)r.hasOwnProperty(o)&&(r[o]=e[o]);this.doPropertyChange("setState",{dataSource:this._get_data("dataSource")})}}};var a=function(e){this._set_data("dataSource",e),this.doPropertyChange("setState",{dataSource:e});var t={};cb.utils.isArray(e)?e.forEach(function(e){r.call(this,e,t)},this):r.call(this,e,t),this._set_data("keyMap",t)},r=function n(e,t){var a=this._get_data("keyField");null!=e[a]&&(t[e[a]]=e,e.children&&e.children.length&&e.children.forEach(function(e){n.call(this,e,t)},this))},o=function(e){e=cb.utils.isArray(e)?e:[e];var t=this._get_data("keyMap"),a=[];return e.forEach(function(e){a.push(t[e])}),a};return t.prototype.select=function(e){var t=o.call(this,e);this.execute("beforeSelect",t)&&(this._set_data("selectedKeys",e),this.doPropertyChange("setState",{selectedKeys:e}),this.execute("select",t),this.execute("afterSelect",t))},t.prototype.getSelectedNodes=function(){return o.call(this,this.getSelectedKeys())},t.prototype.getSelectedKeys=function(){return this._get_data("selectedKeys")},t.prototype.check=function(e){var t=o.call(this,e);this.execute("beforeCheck",t)&&(this._set_data("checkedKeys",e),this.doPropertyChange("setState",{checkedKeys:e}),this.execute("check",t),this.execute("afterCheck",t))},t.prototype.getCheckedNodes=function(){return o.call(this,this.getCheckedKeys())},t.prototype.getCheckedKeys=function(){return this._get_data("checkedKeys")},t.prototype.setReadOnly=function(){},t}),cb.models.DataStates={Insert:"Insert",Update:"Update",Delete:"Delete",Unchanged:"Unchanged"},cb.models.register("GridModel",function(e){var t=function(e){var t={columns:{},dataSource:[],rows:[],readOnly:!0,dataSourceMode:"local",editMode:"cell",autoWrap:!0,mergeCells:!1,showAggregates:!0,multiSort:!0,sortFields:[],showCheckBox:!0,multiple:!0,showRowNo:!1,pagination:!0,pageInfo:{pageSize:50,pageIndex:1},innerUsedAttrs:{id:"_id",selected:"_selected",status:"_status"}};e=cb.utils.extend({},t,e),a(e.columns),e.fieldNames||(e.fieldNames=i(e.columns)),cb.models.BaseModel.call(this,e),e.dataSource.length&&c.call(this,e.dataSource),n.call(this),m.call(this,-1,{})};t.prototype=new cb.models.BaseModel,t.prototype.modelType=e;var a=function(e){for(var t in e){var a=e[t];if("Select"===a.cControlType){var r={valueField:"value",textField:"text",dataSource:[],keyMap:{}};if(cb.utils.extend(!0,a,r,a),a.cEnumString){var o=JSON.parse(a.cEnumString);for(var t in o){var n={};n[a.valueField]=t,n[a.textField]=o[t],a.dataSource.push(n),a.keyMap[t]=n}delete a.cEnumString}}}};t.prototype.setData=function(e){if(!e){var e={columns:this._get_data("columns"),rows:this._get_data("rows"),readOnly:this._get_data("readOnly"),showAggregates:this._get_data("showAggregates"),showCheckBox:this._get_data("showCheckBox"),multiple:this._get_data("multiple"),showRowNo:this._get_data("showRowNo"),pagination:this._get_data("pagination")};return e.pagination&&(e.pageInfo=this._get_data("pageInfo")),void this.doPropertyChange("setGridProps",cb.utils.extend(!0,{},e))}e.columns&&this.setColumns(e.columns,cb.utils.isArray(e.fieldNames)?e.fieldNames:null),cb.utils.isArray(e)&&this.setDataSource(e)};var o=function(e,t){return"Refer"===t?"object"===("undefined"==typeof e?"undefined":r(e))?e.id:e:"Select"===t&&"object"===("undefined"==typeof e?"undefined":r(e))?e.value:e};t.prototype.getDirtyData=function(){for(var e,t,a,r,n=y(),i=v(),s=[],l=this._get_data("dataSource"),c=this._get_data("rowsDataState"),u=this._get_data("columns"),d=this._get_data("originalKeyMap"),f=this._get_data("innerUsedAttrs"),h=f.id,p=f.selected,g=f.status,m=0;m<l.length;m++)if(t=c[m],t!==cb.models.DataStates.Unchanged){var b=l[m];if(t===cb.models.DataStates.Insert){e={};for(var _ in b)_!==h&&_!==p&&(a=u[_],e[_]=o(b[_],a&&a.cControlType));e[g]=t,s.push(e)}else if(t===cb.models.DataStates.Update){r=d[b[h]],e={},S=!1,e[n]=b[n],e[i]=b[i];var S;for(var _ in b)if(_!==h&&_!==p){a=u[_];var x=o(b[_],a&&a.cControlType);x!==r[_]&&(e[_]=x,S=!0)}e[g]=t,S&&s.push(e)}else t===cb.models.DataStates.Delete&&(e={},e[n]=b[n],e[i]=b[i],e[g]=t,s.push(e))}return s.length?s:null},t.prototype.getData=function(){for(var e,t,a,r=[],n=this._get_data("dataSource"),i=this._get_data("rowsDataState"),s=this._get_data("columns"),l=this._get_data("innerUsedAttrs"),c=l.id,u=l.selected,d=l.status,f=0;f<n.length;f++)if(t=i[f],t!==cb.models.DataStates.Delete){var h=n[f];e={};for(var p in h)p!==c&&p!==u&&(a=s[p],e[p]=o(h[p],a&&a.cControlType));e[d]=t,r.push(e)}return r.length?r:null};var n=function(){for(var e=this._get_data("dataSource"),t=new Array(e.length),a=0,r=e.length;a<r;a++)t[a]=cb.models.DataStates.Unchanged;this._set_data("rowsDataState",t)};t.prototype.getColumns=function(e){var t,a,r=this._get_data("columns");if(e)cb.utils.isArray(e)||(e=[e]),e.forEach(function(e){t=cb.utils.extend(!0,{},r[e]),t.fieldName||(t.fieldName=e),a.push(t)});else for(var o in r)t=cb.utils.extend(!0,{},r[o]),t.fieldName||(t.fieldName=o),a.push(t);return a},t.prototype.getColumn=function(e){var t=cb.utils.extend(!0,{},this._get_data("columns")[e]);return t.fieldName||(t.fieldName=e),t},t.prototype.hasColumn=function(e){return this._get_data("columns").hasOwnProperty(e)};var i=function(e){var t=[];for(var a in e)t.push(a);return t};t.prototype.setDirty=function(e){if(e)return void this._set_data("isDirty",!0);this._del_data("isDirty");var t=[],a={},r=this._get_data("dataSource"),o=this._get_data("innerUsedAttrs").id;r.forEach(function(e){var r=cb.utils.extend(!0,{},e);t.push(r),a[r[o]]=r}),this._set_data("originalData",t),this._set_data("originalKeyMap",a)},t.prototype.getCellValue=function(e,t){var a=e>=0?this._get_data("rows")[e]:null;if(a&&t)return a[t]},t.prototype.setCellValue=function(e,t,a,r){var o=e>=0?this._get_data("rows")[e]:null;if(o&&t){var n={rowIndex:e,cellName:t,value:a,oldValue:this.getCellValue(e,t)};r&&!this.execute("beforeCellValueChange",n)||(o[t]=a,p.call(this,e,cb.models.DataStates.Update),this.doPropertyChange("setCellValue",n),r&&this.execute("afterCellValueChange",n))}},t.prototype.getReadOnly=function(){return this.getState("readOnly")},t.prototype.setReadOnly=function(e){this.setState("readOnly",e)},t.prototype.getRowState=function(e,t){var a=e>=0?this._get_data("rows")[e]:null;if(a&&t)return a[t]},t.prototype.setRowState=function(e,t,a){var r=this._get_data("rows"),o=e>=0?r[e]:null;if(o&&t){var n=this.getRowState(e,t);if(n!==a){var i={rowIndex:e,propertyName:t,value:a,oldValue:n};this.execute("beforeRowStateChange",i)&&(r[e][t]=a,this.doPropertyChange("setRowState",i),this.execute("afterRowStateChange",i))}}},t.prototype.getColumnState=function(e,t){var a=this._get_data("columns")[e];if(a&&t)return a[t]},t.prototype.setColumnState=function(e,t,a){var r=this._get_data("columns")[e];if(r&&t){var o=this.getColumnState(rowIndex,t);if(o!==a){var n={cellName:e,propertyName:t,value:a,oldValue:o};this.execute("beforeColumnStateChange",n)&&(this._get_data("columns")[e][t]=a,this.doPropertyChange("setColumnState",n),this.execute("afterColumnStateChange",n))}}},t.prototype.getCellState=function(e,t,a){var o=e>=0?this._get_data("rows")[e]:null;if(o&&t){var n=o[t];return n&&"object"===("undefined"==typeof n?"undefined":r(n))?n[a]:void 0}},t.prototype.setCellState=function(e,t,a,r){var o=this._get_data("rows"),n=e>=0?o[e]:null;if(n&&t){var i=n[t],s=this.getCellState(e,t,a);if(s!==r){var l={rowIndex:e,cellName:t,propertyName:a,value:r,oldValue:s};this.execute("beforeCellStateChange",l)&&(i||(i=o[e][t]={value:i}),i[a]=r,this.doPropertyChange("setCellState",l),this.execute("afterCellStateChange",l))}}},t.prototype.setColumns=function(e,t){a(e),this.execute("beforeSetColumns",e)&&(this._set_data("columns",e),this._set_data("fieldNames",t||i(e)),this.doPropertyChange("setColumns",e),this.execute("afterSetColumns",e))};var s=function(){for(var e=[],t=[],a=this._get_data("dataSource"),r=this._get_data("rowsDataState"),o=0,n=a.length;o<n;o++)if(r[o]!==cb.models.DataStates.Delete){var i=a[o];e.push(i),t.push(cb.utils.extend(!0,{},i))}this._set_data("rows",e),this.doPropertyChange("setDataSource",t)};t.prototype.clear=function(){this._set_data("dataSource",[]),n.call(this),s.call(this)};var l=function(e,t){e.forEach(function(e){for(var a in t){var r=t[a];r&&"Select"===r.cControlType&&(e[a]=r.keyMap[e[a]])}})};t.prototype.setDataSource=function(e,t,a){if("local"===this._get_data("dataSourceMode")){var r=cb.utils.isArray(e)?e:[];if(l(r,this._get_data("columns")),!this.execute("beforeSetDataSource",r))return;this._set_data("dataSource",r),r.length&&c.call(this,r),n.call(this),s.call(this),this.execute("afterSetDataSource",r)}else d.call(this,e,t,a),this._set_data("proxyConfig",e),this._set_data("queryParams",t),this._set_data("callback",a)};var c=function(e){var t=this._get_data("innerUsedAttrs").id;e.forEach(function(e){e[t]=cb.utils.getNewId("rowId")})};t.prototype.setPageSize=function(e){if("number"==typeof e){e=Math.max(-1,e);var t=this._get_data("pageInfo");t.pageSize=e,t.pageIndex=1,u.call(this)}},t.prototype.getPageSize=function(){return this._get_data("pageInfo").pageSize},t.prototype.setPageIndex=function(e){if("number"==typeof e){e=Math.max(1,e);var t=this._get_data("pageInfo");t.pageIndex=e,u.call(this)}},t.prototype.getPageIndex=function(){return this._get_data("pageInfo").pageIndex};var u=function(){var e=this._get_data("proxyConfig");if(e){var t=this._get_data("queryParams"),a=this._get_data("callback");d.call(this,e,t,a)}},d=function(e,t,a){var r=cb.rest.DynamicProxy.create({queryData:e}),o={page:{pageSize:this.getPageSize(),pageIndex:this.getPageIndex()}},i=cb.utils.extend(!0,o,t);r.queryData(i,function(e,t){if(e)return void alert(e.message);if(a)a(t);else{var r=cb.utils.isArray(t.recordList)?t.recordList:[];if(l(r,this._get_data("columns")),!this.execute("beforeSetDataSource",r))return;this._set_data("dataSource",r),r.length&&c.call(this,r),n.call(this),s.call(this);var o={pageSize:t.pageSize,pageIndex:t.pageIndex,pageCount:t.pageCount,recordCount:t.recordCount};this._set_data("pageInfo",o),this.doPropertyChange("setPageInfo",o),this.execute("afterSetDataSource",r)}},this)};t.prototype.select=function(e){if(this.execute("beforeSelect",e)){cb.utils.isArray(e)||(e=[e]);var t=this._get_data("rows"),a=this._get_data("innerUsedAttrs").selected;t.forEach(function(e){e[a]=!1}),e.forEach(function(e){t[e][a]=!0});var r=e[0];m.call(this,r,f.call(this,r)),this.doPropertyChange("select",e),this.execute("afterSelect",e)}};var f=function(e){var t,a,o=this._get_data("columns"),n=this._get_data("rows")[e],i=this._get_data("innerUsedAttrs"),s={};for(var l in n)l!==i.id&&l!==i.selected&&(t=o[l],a=n[l],t?"Refer"===t.cControlType?s[l]="object"===("undefined"==typeof a?"undefined":r(a))?a.name:a:"Select"===t.cControlType?s[l]="object"===("undefined"==typeof a?"undefined":r(a))?a.value:a:s[l]=a:s[l]=a);return s};t.prototype.unselect=function(e){if(this.execute("beforeUnselect",e)){cb.utils.isArray(e)||(e=[e]);var t=this._get_data("rows"),a=this._get_data("innerUsedAttrs").selected;e.forEach(function(e){t[e][a]=!1}),this.doPropertyChange("unselect",e),this.execute("afterUnselect",e)}},t.prototype.selectAll=function(){if(this.execute("beforeSelectAll")){var e=this._get_data("rows"),t=this._get_data("innerUsedAttrs").selected;e.forEach(function(e){e[t]=!0}),this.doPropertyChange("selectAll"),this.execute("afterSelectAll",e)}},t.prototype.unselectAll=function(){if(this.execute("beforeUnselectAll")){var e=this._get_data("rows"),t=this._get_data("innerUsedAttrs").selected;e.forEach(function(e){e[t]=!1}),this.doPropertyChange("unselectAll"),this.execute("afterUnselectAll")}},t.prototype.getSelectedRows=function(){for(var e,t=[],a=this._get_data("innerUsedAttrs").selected,r=this._get_data("rows"),o=0,n=r.length;o<n;o++)e=r[o],e[a]&&t.push(h.call(this,e));return t},t.prototype.getSelectedRowIndexes=function(){for(var e=[],t=this._get_data("innerUsedAttrs").selected,a=this._get_data("rows"),r=0,o=a.length;r<o;r++)a[r][t]&&e.push(r);return e},t.prototype.getRows=function(){var e=[];return this._get_data("rows").forEach(function(t){e.push(h.call(this,t))},this),e},t.prototype.updateRow=function(e,t){if(!this.getReadOnly()){var a=this._get_data("rows")[e];cb.utils.extend(!0,a,t),l([a],this._get_data("columns")),this.doPropertyChange("updateRow",{index:e,row:a})}},t.prototype.insertRow=function(e,t){if(!this.getReadOnly()){var a=cb.utils.extend(!0,{},g.call(this),t);c.call(this,[a]);var r=this._get_data("rows"),o=Math.min(r.length,Math.max(0,e)),n={index:o,row:a};if(this.execute("beforeInsertRow",n)){var i=this._get_data("dataSource"),s=r.length?r[o]?i.indexOf(r[o]):i.indexOf(r[r.length-1])+1:0;this._get_data("dataSource").splice(s,0,a),this._get_data("rowsDataState").splice(s,0,cb.models.DataStates.Insert),r.splice(o,0,a),this.doPropertyChange("insertRow",n),this.execute("afterInsertRow",n)}}},t.prototype.insertRows=function(e,t){if(!this.getReadOnly()&&cb.utils.isArray(t)){var a,r=[];t.forEach(function(e){a=cb.utils.extend(!0,{},g.call(this,e)),r.push(a)},this),c.call(this,r);var o=this._get_data("rows"),n=Math.min(o.length,Math.max(0,e)),i={index:n,rows:r};if(this.execute("beforeInsertRows",i)){var s=this._get_data("dataSource"),l=o.length?o[n]?s.indexOf(o[n]):s.indexOf(o[o.length-1])+1:0;this._get_data("dataSource").splice.apply(this._get_data("dataSource"),[l,0].concat(r));var u=new Array(r.length);u.forEach(function(e){e=cb.models.DataStates.Insert}),this._get_data("rowsDataState").splice.apply(this._get_data("rowsDataState"),[l,0].concat(u)),o.splice.apply(o,[n,0].concat(r)),this._set_data("focusedRowIndex",n),this.doPropertyChange("insertRows",i),this.execute("afterInsertRows",i)}}},t.prototype.appendRow=function(e){if(!this.getReadOnly()){var t=cb.utils.extend(!0,{},g.call(this),e);c.call(this,[t]);var a=this._get_data("rows"),r=a.length,o={index:r,row:t};this.execute("beforeInsertRow",o)&&(this._get_data("dataSource").push(t),this._get_data("rowsDataState").push(cb.models.DataStates.Insert),a.push(t),this.doPropertyChange("insertRow",o),this.execute("afterInsertRow",o))}},t.prototype.deleteRows=function(e){if(!this.getReadOnly()){cb.utils.isArray(e)||(e=[e]);var t=this.getRowsByIndexes(e);if(this.execute("beforeDeleteRows",t)){for(var a,r,o=this._get_data("dataSource"),n=this._get_data("rowsDataState"),i=this._get_data("rows"),s=i.length,e=e.sort(function(e,t){return e-t}),l=e.length-1;l>=0;l--)a=e[l],a<0||a>=s||(r=o.indexOf(i[a]),i.splice(a,1),n[a]===cb.models.DataStates.Insert?(n.splice(r,1),o.splice(r,1)):n[r]=cb.models.DataStates.Delete);this.doPropertyChange("deleteRows",e),this.execute("afterDeleteRows",t)}}},t.prototype.getRowsByIndexes=function(e){var t=[];return cb.utils.isArray(e)||(e=[e]),e.forEach(function(e){t.push(this.getRow(e))},this),t},t.prototype.getRow=function(e){return h.call(this,this._get_data("rows")[e])};var h=function(e){var t,a=this._get_data("columns"),r=this._get_data("innerUsedAttrs"),n=r.id,i=r.selected,s={};for(var l in e)l!==n&&l!==i&&(t=a[l],s[l]=o(e[l],t&&t.cControlType));return s},p=function(e,t){var a=this._get_data("rowsDataState"),r=a[e];r!==cb.models.DataStates.Insert&&r!==cb.models.DataStates.Delete&&(a[e]=t)},g=function(){var e,t={},a=this._get_data("columns");for(var r in a)e=a[r],null!=e.defaultValue&&(t[r]=e.defaultValue);return t},y=function(){return"id"},v=function(){return"pubts"};t.prototype.getEditRowModel=function(){return this._get_data("editRowModel")};var m=function(e,t){if(e!==this._get_data("focusedRowIndex")){this._set_data("focusedRowIndex",e);var a,r,o=this._get_data("columns"),n={};for(var i in o)a=o[i],"Refer"===a.cControlType?(r=new cb.models.ReferModel(cb.utils.extend(!0,{},{multiple:!0},a,{value:t[i]})),r.on("beforeValueChange",function(t){b.call(this.getParent().getParent(),e,this.getName(),t.value)})):"Select"===a.cControlType?(r=new cb.models.ListModel(cb.utils.extend(!0,{},a,{value:t[i]})),r.on("beforeValueChange",function(t){_.call(this.getParent().getParent(),e,this.getName(),t.value)})):(r=new cb.models.SimpleModel(cb.utils.extend(!0,{},a,{value:t[i]})),r.on("beforeValueChange",function(t){_.call(this.getParent().getParent(),e,this.getName(),t.value)})),r.on("blur",function(){this.getParent().getParent().doPropertyChange("setCellBlur",{rowIndex:e,cellName:this.getName()})}),r.on("enter",function(){this.getParent().getParent().doPropertyChange("setCellEnter",{rowIndex:e,cellName:this.getName()})}),n[i]=r;r=new cb.models.ContainerModel,r.setParent(this),r.setData(n),this._set_data("editRowModel",r)}},b=function(e,t,a){if(cb.utils.isArray(a)&&a.length&&(this.setCellValue(e,t,a[0],!0),a.length>1))for(var r=1,o=a.length;r<o;r++)this.insertRow(e+r),this.setCellValue(e+r,t,a[r],!0)},_=function(e,t,a){this.setCellValue(e,t,a,!0)};return t}),cb.models.register("ContainerModel",function(e){var t=function(e){cb.models.BaseModel.call(this,e)};t.prototype=new cb.models.BaseModel,t.prototype.modelType=e,t.prototype.getParams=function(){return this._get_data("params")},t.prototype.set=function(e,t){t instanceof cb.models.BaseModel&&(t.setParent(this),t.setName(e)),this._set_data(e,t)},t.prototype.get=function(e){return this._get_data(e)},t.prototype.setData=function(e){if(arguments.length){var t=this._get_data("propertyNames");for(var a in e){t.indexOf(a)<0&&t.push(a);var r=e[a],o=this.get(a);o&&o.setData?o.setData(r):this.set(a,r)}}},t.prototype.getData=function(e){var t,a=this._get_data("propertyNames");return a.forEach(function(a){if(t=this.get(a),t instanceof cb.models.BaseModel&&t._get_data("needCollect")!==!1){var r=t.getData("value");e[a]=r}},this),e},t.prototype.getOriginalData=function(){var e,t=this._get_data("propertyNames"),a={};return t.forEach(function(t){if(e=this.get(t),e instanceof cb.models.BaseModel&&e._get_data("needCollect")!==!1){var r=e._get_data("originalData");a[t]=r}},this),a},t.prototype.setDirty=function(e){if(e)return void this._set_data("isDirty",!0);this._del_data("isDirty");var t,a=this._get_data("propertyNames");a.forEach(function(a){t=this.get(a),t instanceof cb.models.BaseModel&&t.setDirty(e)},this)},t.prototype.getDirtyData=function(e){var t,a,r=this._get_data("propertyNames");return r.forEach(function(r){if(t=this.get(r),t instanceof cb.models.BaseModel&&t._get_data("needCollect")!==!1){var o=t.getDirtyData();null!=o&&(e[r]=o,a=!0)}},this),a},t.prototype.loadData=function(e){this.clear(),this.setData(e),this.setDirty(!1)},t.prototype.loadDirtyData=function(e){this.clear(),
this.setData(e)},t.prototype.clear=function(){var e,t=this._get_data("propertyNames");t.forEach(function(t){e=this.get(t),e instanceof cb.models.BaseModel&&e._get_data("needCollect")!==!1&&e.clear()},this)},t.prototype.collectData=function(e){var t={};if(t[a()]=this.getPkValue(),t[r()]=this.getTsValue(),e)return this.getData(t);var o=this.getDirtyData(t);return o?t:void 0},t.prototype.setReadOnly=function(e){var t,a=this._get_data("propertyNames");a.forEach(function(a){t=this.get(a),t instanceof cb.models.BaseModel&&t.setReadOnly(e)},this)},t.prototype.getGridModel=function(e){if(e)return this.get(e);var t=this._get_data("gridModel");if(t)return t;for(var a=this._get_data("propertyNames"),r=0,o=a.length;r<o;r++)if(t=this.get(a[r]),t instanceof cb.models.GridModel)return this._set_data("gridModel",t),t},t.prototype.getTreeModel=function(e){if(e)return this.get(e);var t=this._get_data("treeModel");if(t)return t;for(var a=this._get_data("propertyNames"),r=0,o=a.length;r<o;r++)if(t=this.get(a[r]),t instanceof cb.models.TreeModel)return this._set_data("treeModel",t),t};var a=function(){return"id"};t.prototype.getPkValue=function(){return this.get(a()).getValue()};var r=function(){return"pubts"};return t.prototype.getTsValue=function(){return this.get(r()).getValue()},t}),cb.cache={get:function(e){return this[e]},set:function(e,t){this[e]=t},clear:function(){for(var e in this)"get"!==e&&"set"!==e&&"clear"!==e&&delete this[e]}},cb.cache.newIds={get:cb.cache.get,set:cb.cache.set,clear:cb.cache.clear},cb.viewmodels={},cb.viewmodels.register=function(e,t){cb.viewmodels[e]=t(e)},cb.loader={},cb.loader.fromMenu=function(e,t){"meta"===e.viewtype&&this.byBillNo({billtype:e.metatype,billno:e.metakey},t)},cb.loader.byBillNo=function(e,t){if(e.billtype&&e.billno){var r=a(472)("./"+e.billtype.toLowerCase())["default"];r.init(e.billno,e.params,t)}},cb.rest={},cb.rest._getUrl=function(e,t){var a=cb.rest.AppContext,r=new cb.utils.queryString(e);if(r.set("token",a.token||""),("IE"===cb.utils.browser()||t&&t.refresh)&&r.set("_",(new Date).valueOf()),e=r.pathname+r.toStr(),e.indexOf("http://")<0){"/"!==e.substr(0,1)&&(e="/"+e);var o=t&&t.unsure===!1?"":"/api-unsure";e=a.serviceUrl+o+e}return e},cb.rest._appendUrl=function(e,t){if(!t)return e;var a=[];for(var r in t)a.push(r+"="+t[r]);if(!a.length)return e;var o=a.join("&");return e.indexOf("?")>=0?e+"&"+o:e+"?"+o},cb.rest.DynamicProxy=function(e){this.init&&this.init(e)},cb.rest.DynamicProxy.create=function(e){return new cb.rest.DynamicProxy(e)},cb.rest.DynamicProxy.prototype.init=function(e){if(e){this.config=e;for(var t in this.config)this[t]=function(e){return function(t,a,r){return this.Do(e,t,a,null,r)}}(t),this[t+"Sync"]=function(e){return function(t){return this.Do(e,t,null,!1)}}(t)}},cb.rest.DynamicProxy.prototype.Do=function(e,t,a,r,o){if(this.config&&this.config[e]&&this.config[e].url){var n=this.config[e],i=n.url,s=cb.utils.extend({},n.options);return s.method=n.method||"GET","function"==typeof t?(s.callback=t,s.context=o||s.context||this):s.params=t,a&&(s.callback=a,s.context=o||s.context||this),r===!1&&(s.async=!1),this.ajax(i,s)}},cb.rest.DynamicProxy.prototype.ajax=function(e,t){return cb.rest.ajax(e,t)},cb.rest.MergeProxy=function(){var e={datas:[],events:[]};this.add=function(e,t,a,r){if($.isArray(e)){var o=e.length;if($.isArray(t)){if(t.length===o)for(var n=0;n<o;n++)this.addInner(e[n],t[n],a,r)}else for(var n=0;n<o;n++)this.addInner(e[n],t,a,r)}else this.addInner(e,t,a,r)},this.addInner=function(t,a,r,o){var n,i=t.method.toLocaleUpperCase(),s=cb.rest._getUrl(t.url,t.options);"GET"===i||"DELETE"===i?(s=cb.rest._appendUrl(s,a),n=null):n=a,e.datas.push({requestUrl:s,requestMethod:i,requestData:n}),e.events.push({callback:r,context:o})},this.submit=function(t){if(e.datas.length){var a=cb.rest.DynamicProxy.create({BatchSubmit:{url:"client/batchSubmit",method:"POST"}});a.BatchSubmit(e.datas,function(a,r){if(t)return void t(a,r);if(a)return void alert("合并请求提交失败: "+a);var o=r&&r.length;if(o){for(var n=0;n<o;n++){var i=e.events[n];i&&cb.rest.AjaxRequestManager.processAjaxResult(r[n],i.callback,i.context)}cb.rest.AppContext.simulate&&setTimeout(function(){$(document.body).append('<div class="readyForCrawler"></div>')},3e3)}})}}},cb.rest.MergeProxy.create=function(){return new cb.rest.MergeProxy},cb.rest.ajax=function(e,t){return t.url=e,cb.rest.AjaxRequestManager.doRequest(t)},cb.rest.AjaxRequestManager={_xhrs:[],doRequest:function(e){var t=this.getXMLHttpRequest();if(t){var a=e.method||"GET",r=cb.rest._getUrl(e.url,e),o=null;if(a.equalsIgnoreCase("get")||a.equalsIgnoreCase("delete")?r=cb.rest._appendUrl(r,e.params):(a.equalsIgnoreCase("post")||a.equalsIgnoreCase("put"))&&(o=JSON.stringify(e.params)),t.open(a,r,e.async!==!1),t.setRequestHeader("Content-Type","application/json;charset=utf-8"),t.send(o),e.async===!1)return this.onreadystatechange(t,e);t.onreadystatechange=function(){cb.rest.AjaxRequestManager.onreadystatechange(this,e)},e.mask===!0&&cb.util.loadingControl.start()}},onreadystatechange:function(e,t){if(4===e.readyState){if(t.mask===!0&&cb.util.loadingControl.end(),200===e.status){var a=JSON.parse(e.responseText);cb.rest.AjaxRequestManager.processAjaxResult(a,t.callback,t.context)}e.isBusy=!1}},getXMLHttpRequest:function(){for(var e,t=0,a=this._xhrs.length;t<a;t++)if(!this._xhrs[t].isBusy){e=this._xhrs[t];break}return e||(e=this.createXMLHttpRequest(),this._xhrs.push(e)),e.isBusy=!0,e},createXMLHttpRequest:function(){var e=window.XMLHttpRequest?new XMLHttpRequest:window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):null;return e},processAjaxResult:function(e,t,a){if(e&&e.code)if(200==e.code)t&&t.call(a,null,e.data);else{if(900===e.code)return void cb.route.redirectLoginPage();t&&t.call(a,e)}}},cb.rest.ContextBuilder={construct:function(){cb.rest.AppContext={serviceUrl:location.protocol+"//"+location.host};var e=cb.utils.getCookie("user");e&&cb.utils.extend(!0,cb.rest.AppContext,JSON.parse(e))}},cb.rest.ContextBuilder.construct()},53:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=t.billMerge=function n(e,t){if(!e&&!t)return null;var a=function(a){t[a]instanceof Array?e[a]instanceof Array&&t[a].map(function(t,r){n(e[a][r],t)}):e[a]=t[a]};for(var r in t)a(r);return e},r=(t.setVmParams=function(e,t,a){e.getParams()&&(e.getParams()[t]=a)},t.getVmParams=function(e,t){return e.getParams()?e.getParams()[t]||{}:{}}),o=t.doProxy=function(e,t,a){var r=cb.rest.DynamicProxy.create({doProxy:{url:e.cSvcUrl,method:e.cHttpMethod}});r.doProxy(a,function(e,a){return e?void(e.message?alert("出错啦后台->"+e.message):alert("出错啦后台->"+e.code)):void(t&&t(a))})};t.todo=function(e,t,a,o){if(t&&e.action()[t.toLowerCase()]){if(!a.execute("beforeDelete",a))return;console.log("Voucher-- "+t+" click");var n=r(a,"billNo");if(e.action()[t.toLowerCase()](n,a,o),!a.execute("afterDelete",a))return}else console.log("voucher->do——"+t+"方法不存在")},t.check=function(e,t,r,n){if(r){n||(r.location="-1");var i=t.collectData(!0),s={billnum:e,item:JSON.stringify(r),data:JSON.stringify(i)},l={cSvcUrl:"bill/check.do",cHttpMethod:"POST"},c=function(e){if(e)if(n){var o=t.getGridModel(),s=o.getRow(r.location),l=a(s,e);o.updateRow(r.location,l)}else{var c=a(i,e);t.loadData(c)}};o(l,c,s)}},t.refercheck=function(e,t,a,r){var o=void 0,n=t.getGridModel();if(r){var i=n.getColumn(a.key);o=i.cRefRetId}else o=t.get(a.key)._get_data("cRefRetId");o&&(o=JSON.parse(o));for(var s in o){var l=o[s];r?n.setCellValue(a.location,s,a.value[l]):t.get(s).setValue(a.value[l])}}},92:function(e,t){"use strict";var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};cb.viewmodels.register("ReferViewModel",function(e){var t=function(e){cb.models.ContainerModel.call(this,e),this.init()};return t.prototype=new cb.models.ContainerModel,t.prototype.modelType=e,t.prototype.init=function(){var e={referInput:new cb.models.SimpleModel,referButton:new cb.models.SimpleModel,tree:new cb.models.TreeModel({keyField:"code",titleField:"name"}),searchBox:new cb.models.SimpleModel,filter:new cb.models.SimpleModel,reload:new cb.models.SimpleModel,setting:new cb.models.SimpleModel,table:new cb.models.GridModel({showAggregates:!1,multiple:this.getParams().multiple}),submit:new cb.models.SimpleModel,cancel:new cb.models.SimpleModel};this.setData(e),this.initData(),this.setDirty(!1),this.get("reload").on("click",function(e){r.reloadAction(this.getParent(),e)}),this.get("filter").on("click",function(e){r.filterAction(this.getParent(),e)}),this.get("setting").on("click",function(e){r.settingAction(this.getParent(),e)}),this.get("tree").on("select",function(e){r.treeSelected(this.getParent(),e)}),this.get("searchBox").on("click",function(e){r.searchClick(this.getParent(),e)})},t.prototype.proxy=cb.rest.DynamicProxy.create({InitReferModal:{url:"pub/ref/showRef.do",method:"GET",options:{token:!0}},getGridMeta:{url:"pub/ref/getGridMeta.do",method:"GET",options:{token:!0}},getGridData:{url:"pub/ref/getGridData.do",method:"POST",options:{token:!0}}}),t.prototype.initData=function(){"object"==("undefined"==typeof r?"undefined":a(r))&&r.doAction("init_Extend",this);var e=(cb.utils.extend(!0,{},this.getParent().getFilter(),this.getParent().getSelectedNodes()&&this.getParent().getSelectedNodes().length&&this.getParent().getSelectedNodes()[0]||{name:this.getParent().getValue()}),this);this.proxy.InitReferModal({refID:this.getParams().refId},function(t,a){return t?void console.error("InitReferModal:"+t.message):(e.execute("afterInit",a.refEntity.cTpltype),e._set_data("referType",a.refEntity.cTpltype),a.treeData&&e.get("tree").setDataSource(a.treeData),void("Tree"!=a.refEntity.cTpltype&&(e.get("table").setColumns(e.getColumnsData(a.gridMeta)),e.get("table").setDataSource(a.gridData.recordList))))})},t.prototype.getColumnsData=function(e){for(var t={},a=e.viewmodel.entities.filter(function(e){return"Bill"==e.cType})[0].fields,r=0;r<a.length;r++){var o=a[r];t[o.cFieldName]=o}return t},t.prototype.okClick=function(){var e=this.get("table").getSelectedRows();"Tree"==this._get_data("referType")&&(e=this.get("tree").getSelectedNodes()),this.execute("afterOkClick",e)},t});var r={doAction:function(e,t){this[e](t)},init_Extend:function(e){},reloadAction:function(e,t){"Tree"!=e._get_data("referType")&&e.proxy.getGridData({refID:e.getParams().refId},function(t,a){return t?void console.error(t.message):void e.get("table").setDataSource(a.recordList)})},filterAction:function(e,t){console.log("filter")},settingAction:function(e,t){console.log("setting")},treeSelected:function(e,t){if(0!=t.length&&(e.get("searchBox").setValue(""),"Tree"!=e._get_data("referType"))){var a={refID:e.getParams().refId,path:t[0].path,page:{pageIndex:1,pageSize:10}};a.page=JSON.stringify(a.page),e.proxy.getGridData(a,function(t,a){return t?void console.error(t.message):void e.get("table").setDataSource(a.recordList)})}},searchClick:function(e,t){console.log("searchClick--"+t)}}},140:function(e,t){"use strict";var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};cb.viewmodels.register("BillMakerViewModel",function(e){var t=function(e){cb.models.ContainerModel.call(this,e),this.init()};return t.prototype=new cb.models.ContainerModel,t.prototype.modelType=e,t.prototype.init=function(){var e={headGrid:new cb.models.GridModel,bodyGrid:new cb.models.GridModel};this.setData(e),this.initData(),this.setDirty(!1)},t.prototype.proxy=cb.rest.DynamicProxy.create({getTreeData:{url:"menu/getMenuTree.do",method:"POST",options:{}},InitReferModal:{url:"pub/ref/showRef.do",method:"GET",options:{token:!0}},getGridMeta:{url:"pub/ref/getGridMeta.do",method:"GET",options:{token:!0}},getGridData:{url:"pub/ref/getGridData.do",method:"POST",options:{token:!0}}}),t.prototype.initData=function(){"object"==("undefined"==typeof r?"undefined":a(r))&&r.doAction("init_Extend",this);var e=this;this.proxy.InitReferModal({refID:1},function(t,a){return t?void console.error("InitReferModal:"+t.message):(e.execute("afterInit",a.refEntity.cTpltype),e._set_data("referType",a.refEntity.cTpltype),a.treeData&&e.get("tree").setDataSource(a.treeData),e.get("table").setColumns(e.getColumnsData(a.gridMeta)),void e.get("table").setDataSource(a.gridData.recordList))})},t.prototype.getColumnsData=function(e){for(var t={},a=e.viewmodel.entities[0].fields,r=0;r<a.length;r++){var o=a[r];t[o.cFieldName]=o}return t},t.prototype.okClick=function(){var e=this.get("table").getSelectedRows();"Tree"==this._get_data("referType")&&(e=this.get("tree").getSelectedNodes()),this.execute("afterOkClick",e)},t});var r={doAction:function(e,t){this[e](t)},init_Extend:function(e){},treeSelected:function(e,t){if(0!=t.length){e.get("searchBox").setValue("");var a={refID:1,condition:{filtersId:3,commonVOs:[],advanceVOs:{}},page:{pageIndex:1,pageSize:10}};a.condition.commonVOs.push({itemName:"path",value1:t[0].path}),a.condition=JSON.stringify(a.condition),a.page=JSON.stringify(a.page),e.proxy.getGridData(a,function(t,a){return t?void console.error(t.message):void e.get("table").setDataSource(a.recordList)})}}}},141:function(e,t,a){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t["default"]=e,t}Object.defineProperty(t,"__esModule",{value:!0});var o=a(53),n=r(o),i=function(){var e=function(e,t,a){var r={},a={cSvcUrl:"makeBill/getMakeVoucherShowData.do",cHttpMethod:"POST"};r.makeVoucherRuleId=t.getParams().makeBillId;var o=function(e){var a=t.get("MakeBillCache");a.mainId=e.mainId,a.childId=e.childId,a.childForId=e.childForId;var r=t.get("Head");t.get(r).setDataSource(e.headData)};n.doProxy(a,o,r)},t=function(e,t,a){if("head"===a.type){var r={},a={cSvcUrl:"makeBill/getBodyData.do",cHttpMethod:"POST"},o=t.get(t.get("Head")).getSelectedRows(),i=t.get(t.get("Body")).getSelectedRows(),s=t.get("MakeBillCache"),l=[],c=[];o.forEach(function(e){l.push(e[s.mainId]),s[e[s.mainId]]||c.push(e[s.mainId])}),r.headIds=c.join(","),r.makeBillId=t.getParams().makeBillId;var u=function(e){e.forEach(function(e){s[e[s.childForId]]||(s[e[s.childForId]]=[]),s[e[s.childForId]].push(e)});var a=[];l.forEach(function(e){var t=s[e];t&&t.forEach(function(e){a.push(e)})});var r=[];i.forEach(function(e){r.push(e[s.childId])}),t.get(t.get("Body")).setDataSource(a);var o=[];r.forEach(function(e){for(var t=0;t<a.length;t++)e===a[t][s.mainId]&&o.push(t)}),t.get(t.get("Body")).select(o)};n.doProxy(a,u,r)}},a=function(e,t,a){if("head"===a.type){var r=t.get("MakeBillCache"),o=t.get(t.get("Head")).getRowsByIndexes(a.rowIndexes);delete r[o[0][r.mainId]];var n=t.get(t.get("Head")).getSelectedRows(),i=[];if(n.forEach(function(e){i.push(e[r.mainId])}),0!==i.length){var s=[];i.forEach(function(e){var t=r[e];t&&t.forEach(function(e){s.push(e)})}),t.get(t.get("Body")).setDataSource(s)}else t.get(t.get("Body")).setDataSource([])}},r=function(e,t,a){if("head"===a.type){var r={},a={cSvcUrl:"makeBill/getBodyData.do",cHttpMethod:"POST"},o=t.get(t.get("Head")).getSelectedRows(),i=t.get("MakeBillCache"),s=[],l=[];o.forEach(function(e){s.push(e[i.mainId]),i[e[i.mainId]]||l.push(e[i.mainId])}),r.headIds=l.join(","),r.makeBillId=t.getParams().makeBillId;var c=function(e){e.forEach(function(e){i[e[i.childForId]]||(i[e[i.childForId]]=[]),i[e[i.childForId]].push(e)});var a=[];s.forEach(function(e){var t=i[e];t&&t.forEach(function(e){a.push(e)})}),t.get(t.get("Body")).setDataSource(a);var r=t.get(t.get("Body")).getSelectedRowIndexes();t.get(t.get("Body")).select(r)};n.doProxy(a,c,r)}},o=function(e,t,a){if("head"===a.type){var r=t.get("MakeBillCache");r={},t.get(t.get("Body")).setDataSource([])}};return{init:function(e,t,a){var r=this,o=cb.rest.DynamicProxy.create({getMeta:{url:"/meta.do/bill/"+e,method:"GET",options:{unsure:!1}}});o.getMeta(function(e,o){if(e)return void console.error(e);var n=new Function(o.vm);n();var i={billNo:o.viewmeta.cBillNo,subId:o.viewmeta.cSubId},s=new cb.viewmodels[o.viewmeta.vmName]({params:cb.utils.extend(!0,{},i,t)}),l=s.get("Head"),c=s.get("Body");s.get(l).on("afterSelect",function(e){var t={};t.rowIndexes=e,t.type="head",r["do"]("selectgrid",s,t)}),s.get(l).on("afterUnselect",function(e){var t={};t.rowIndexes=e,t.type="head",r["do"]("unselectgrid",s,t)}),s.get(l).on("afterSelectAll",function(e){var t={};t.rows=e,t.type="head",r["do"]("selectall",s,t)}),s.get(l).on("afterUnselectAll",function(){var e={};e.type="head",r["do"]("unselectall",s,e)}),s.get(c).on("afterSelect",function(e){var t={};t.rowIndexes=e,t.type="body",r["do"]("selectgrid",s,t)}),s.get(c).on("afterUnselect",function(e){var t={};t.rowIndexes=e,t.type="body",r["do"]("unselectgrid",s,t)}),a(s,o.viewmeta),r["do"]("load",s)})},"do":function(e,t,a){n.todo(this,e,t,a)},action:function(){return{loadgrid:e,selectgrid:t,unselectgrid:a,selectall:r,unselectall:o}}}}();cb.namespace("biz.common"),cb.biz.common.billmaker=i,t["default"]=i},142:function(e,t,a){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t["default"]=e,t}Object.defineProperty(t,"__esModule",{value:!0});var o=a(53),n=r(o),i=function(){var e=function(e,t){n.setVmParams(e,"mode",t)},t=function(e,t){o(e),e.loadData(t),i(e)},r=function(e,t,a){var r=t.getGridModel(),o=a.cellName,i=r.getColumn(o);if(i.bCheck===!0){var s={location:a.rowIndex,key:o,value:a.value};"refer"==i.cControlType.toLowerCase()?n.refercheck(e,t,s,!0):n.check(e,t,s,!0)}},o=function(e){var t="add"!=n.getVmParams(e,"mode");e.setReadOnly(t)},i=function(e){var t=n.getVmParams(e,"mode"),a=e.get("states");if(a&&a.length>0&&(a=a.filter(function(e){return e.code==t}),1==a.length)){var r=a[0].items.filter(function(e){return"toolbaritem"==e.cGroup}),o=!0,i=!1,s=void 0;try{for(var l,c=r[Symbol.iterator]();!(o=(l=c.next()).done);o=!0){var u=l.value,d=e.get(u.cName),f=(u.bVisible,!u.bEnable);d&&d.setData("disabled",f)}}catch(h){i=!0,s=h}finally{try{!o&&c["return"]&&c["return"]()}finally{if(i)throw s}}}},s=function(e,a){var r={billnum:e},o="",i="";switch(a.getParams().mode=a.getParams().mode||"browse",a.getParams().mode){case"add":o="bill/add.do",i="POST";break;case"detail":o="bill/detail.do",i="GET",r.id=a.getParams().id;break;case"browse":o="bill/enter.do",i="GET",r.subid=a.getParams().subId}var s={cSvcUrl:o,cHttpMethod:i},l=function(e){t(a,e)};n.doProxy(s,l,r)},l=function(e,a,r){var o=a.collectData();if(o){var n=confirm("确定要放弃么");n&&t(a,a.getOriginalData())}else a.setReadOnly(!0)},c=function(t,a,r){e(a,"edit"),i(a),a.setReadOnly(!1)},u=function(e,a,r){var o=a.getPkValue(),i=a.getTsValue();if(!i)return void alert("单据没有 pubts");var s={id:o,pubts:i},l={billnum:e,data:JSON.stringify(s)},c=function(e){alert("操作成功");var r=a.collectData(!0),o=n.billMerge(r,e);t(a,o)};n.doProxy(r,c,l)},d=function(e,t,a){t.getGridModel().appendRow()},f=function(e,t,a){var r=t.getGridModel().getSelectedRowIndexes();t.getGridModel().deleteRows(r)},h=function(e,t,a){var r=t.getGridModel().getSelectedRowIndexes();r.length&&t.getGridModel().insertRow(r[0])},p=function(e,t,a){var r=t.getGridModel().getSelectedRowIndexes();if(r.length){var o=t.getGridModel().getSelectedRows();t.getGridModel().insertRow(r[0],o[0])}},g=function(a,r,o){var i=r.collectData();if(!i)return void r.setReadOnly(!0);var s=r.getPkValue();if(s)i._status=cb.models.DataStates.Update;else{i._status=cb.models.DataStates.Insert;var l=n.getVmParams(r,"parentId");if(void 0!=l){var c=n.getVmParams(r,"foreignKey");c&&(i[c]=l)}}var u={billnum:a,data:JSON.stringify(i)},d=function(a){alert("保存成功"),e(r,"browse");var o=r.collectData(!0),i=n.billMerge(o,a);t(r,i)};n.doProxy(o,d,u)},y=function(e,t,a){var r=t.getPkValue(),o=t.getTsValue();if(!o)return void alert("单据没有 pubts");var i={id:r,pubts:o},s={billnum:e,data:JSON.stringify(i)};n.doProxy(a,function(e){alert("操作成功")},s)},v=function(e,a,r){var o={billnum:e},i=function(e){t(a,e)};n.doProxy(r,i,o)},m=function(e,a,r){var o={billnum:e},i=a.getPkValue();i&&(o.id=i);var s=function(e){t(a,e)};n.doProxy(r,s,o)},b=function(e,t,a){var r=new cb.utils.queryString(a.cSvcUrl);r.has("makeBillId")?cb.loader.byBillNo({billtype:"billmaker",billno:r.get("billno"),params:{makeBillId:r.get("makeBillId")}},function(e,r){e.on("afterOkClick",function(e){e.data&&(t.setReadOnly(!1),t.loadData(e.data))}),t.get(a.key).doPropertyChange("communication",{com:"./billmakermodal",data:{vm:e,viewmeta:r}})}):n.doProxy({cSvcUrl:"bill/add.do",cHttpMethod:"POST"},function(e){t.setReadOnly(!1),t.clear(),t.loadData(e)},{billnum:e})},_=function(e,t,a){var r={bill:{billno:e,id:t.getPkValue()}};t.collectData()&&(r.currData={data:t.collectData(!0)}),n.doProxy({cSvcUrl:"/bill/print/printBill.do",cHttpMethod:"POST"},function(e){window.open("files"+e)},r)},S=function(e){try{a(473)("./"+e.viewmeta.cSubId+"/"+e.viewmeta.extendFileName)["default"]}catch(t){console.error(t)}};return{init:function(e,t,a){var r=this,o=cb.rest.DynamicProxy.create({getMeta:{url:"/meta.do/bill/"+e,method:"GET",options:{unsure:!1}}});o.getMeta(function(e,o){if(e)return void console.error(e);S(o);var n=new Function(o.vm);n();var i={billNo:o.viewmeta.cBillNo,subId:o.viewmeta.cSubId,foreignKey:o.viewmeta.foreignKey},s=new cb.viewmodels[o.viewmeta.vmName]({params:cb.utils.extend(!0,{},i,t)});a(s,o.viewmeta),r["do"]("load",s)})},"do":function(e,t,a){n.todo(this,e,t,a)},action:function(){return{load:s,abandon:l,edit:c,save:g,addrow:d,insertrow:h,deleterow:f,copyrow:p,dodelete:y,audit:u,unaudit:u,close:u,open:u,movefirst:v,movelast:v,moveprev:m,movenext:m,create:b,check:n.check,refercheck:n.refercheck,cellcheck:r,output:_,print:_}}}}();cb.namespace("biz.common"),cb.biz.common.voucher=i,t["default"]=i},143:function(e,t,a){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t["default"]=e,t}Object.defineProperty(t,"__esModule",{value:!0});var o=a(53),n=r(o),i=function(){var e=this,t=function(e){var t=void 0,a=void 0,r=e.getTreeModel();return r&&(t=r.getSelectedNodes()),t&&t.length&&t[0]&&(a=t[0]),a},a=function(e,a,r){var o=t(a);o&&(r.parent=o.id),n.check(e,a,r)},r=function(e,a,r){var o=n.getVmParams(a,"cardKey");if(!o)return void alert("元数据未配置cCardKey");var i=void 0,s=t(a);s&&(i=s.id),cb.loader.byBillNo({billtype:"voucher",billno:o,params:{mode:"add",parentId:i}},function(e,t){a.doPropertyChange("communication",{payload:{menuName:t.cBillName,vm:e,metaData:t}})})},o=function(e,t,a){t.clear()},i=function(e,a,r){var o=a.collectData();if(o){var i=a.getPkValue();if(i)o._status=cb.models.DataStates.Update;else{o._status=cb.models.DataStates.Insert;var s=t(a);if(s){o.parent=s.id;var l=!s.level||1;o.level=parseInt(l)+1,o.path=s.path}}var c={billnum:e,data:JSON.stringify(o)},u=function(e,t){var r=a.collectData(!0),o=n.billMerge(r,e),i=a.getTreeModel();if(a.getPkValue())i.updateNode(o);else{var s=i.getSelectedKeys(),l=void 0;s&&s.length&&void 0!=s[0]&&(l=s[0]),i.addNode(o,l)}alert("保存成功")};n.doProxy(r,u,c)}},s=function(t,a,r){var o=a.getGridModel(),i=o.getSelectedRows();return i&&0!=i.length?void!function(){var a=new Array;i.forEach(function(e){e.id&&e.pubts&&a.push({id:e.id,pubts:e.pubts})},e);var o={billnum:t,data:JSON.stringify(a)},s=function(e){alert("ok")};n.doProxy(r,s,o)}():void alert("请选择")},l=function(e,t,a){var r=cb.utils.extend(!0,a,{billnum:e});c(t,r)},c=function(e,t){var a=e.getGridModel();a&&a.setDataSource({url:"bill/list.do",method:"POST"},t)},u=function(e,t){var a=e.getGridModel();a&&a.on("dblClick",function(e){var t=this.getParent();cb.loader.byBillNo({billtype:"voucher",billno:n.getVmParams(t,"cardKey"),params:{mode:"detail",id:e.id}},function(e,a){t.doPropertyChange("communication",{payload:{menuName:a.cBillName,vm:e,metaData:a}})})})},d=function(e,t){var a=e.getTreeModel();a&&a.setDataSource({url:"bill/querytree.do",method:"POST"},t)},f=function(e,t){var a=e.getTreeModel();a&&a.on("select",function(a){var r=e.getGridModel();if(r&&a.length)c(e,{billnum:t,path:a[0].path});else{var o=a[0];e.loadData(o)}})},h=function(e,t){var a=n.getVmParams(e,"billType");switch(a){case"VoucherList":u(e,t);break;case"ArchiveList":d(e,{billnum:t,treename:n.getVmParams(e,"treeName")}),f(e,t);break;case"TreeArchive":d(e,{billnum:t,treename:n.getVmParams(e,"treeName")}),f(e,t)}},p=function(e,t,a){var r=t.getGridModel(),o={bill:{page:{pageSize:r.getPageSize(),pageIndex:r.getPageIndex()},billnum:e}};n.doProxy({cSvcUrl:"/bill/print/printBillList.do",cHttpMethod:"POST"},function(e){window.open("files"+e)},o)};return{init:function(e,t,a){var r=cb.rest.DynamicProxy.create({getMeta:{url:"/meta.do/bill/"+e,method:"GET",options:{unsure:!1}}});r.getMeta(function(r,o){if(r)return void console.error(r);var n=new Function(o.vm);n();var i={treeName:o.viewmeta.treeName,cardKey:o.viewmeta.cCardKey},s=new cb.viewmodels[o.viewmeta.vmName];cb.utils.extend(!0,s.getParams(),i,t),a(s,o.viewmeta),h(s,e)})},"do":function(e,t,a){n.todo(this,e,t,a)},action:function(){return{create:r,save:i,add:o,batchdelete:s,batchaudit:s,batchunaudit:s,search:l,print:p,check:a,refercheck:n.refercheck}}}}();cb.namespace("biz.common"),cb.biz.common.voucherlist=i,t["default"]=i},144:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a={doAction:function(e,t){this[e]&&this[e](t)},init:function(e){console.log("extend--init")}};cb.namespace("biz.PU"),cb.biz.PU.pu_order_Extend=a,t["default"]=a},472:function(e,t,a){function r(e){return a(o(e))}function o(e){return n[e]||function(){throw new Error("Cannot find module '"+e+"'.")}()}var n={"./billMakerViewModel":140,"./billMakerViewModel.js":140,"./billmaker":141,"./billmaker.js":141,"./common":53,"./common.js":53,"./referViewModel":92,"./referViewModel.js":92,"./voucher":142,"./voucher.js":142,"./voucherlist":143,"./voucherlist.js":143};r.keys=function(){return Object.keys(n)},r.resolve=o,e.exports=r,r.id=472},473:function(e,t,a){function r(e){return a(o(e))}function o(e){return n[e]||function(){throw new Error("Cannot find module '"+e+"'.")}()}var n={"./PU/PUpu_orderViewModel.Extend":144,"./PU/PUpu_orderViewModel.Extend.js":144};r.keys=function(){return Object.keys(n)},r.resolve=o,e.exports=r,r.id=473}});